# PHPコーディング規約

## プロダクトコード

### コーディングスタイル

* 原則として、日本語で記述する
* [外来語](https://ja.wiktionary.org/wiki/%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA:%E6%97%A5%E6%9C%AC%E8%AA%9E_%E5%A4%96%E6%9D%A5%E8%AA%9E)はカタカナ(伸ばし無し)で記述する
* [プログラムの専門用語](https://ja.wikipedia.org/wiki/%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0%E7%94%A8%E8%AA%9E%E4%B8%80%E8%A6%A7)はカタカナで記述する

* 日本語以外のスタイルは[PSR-12](https://www.php-fig.org/psr/psr-12/)に従う
* TODO Laravelの規約を見つけた場合はそれに従う(教えてほしい)

##### 例

```php
class ユーザ
{
    private $パスワード 

    public function パスワードが一致するか($パスワード)
    {
        // ...
    }

    public function パスワードを変更する($パスワード)
    {
        // ...
    }
}
```

#### elseについて

`else`は使用しない。`elseif`は使用できる。

#### エディタ関連

* @TODO

### Docコメントについて

* クラスの説明をDocコメントに記載する
* メソッドの説明をDocコメントに記載する
  * ただし、privateメソッドで説明するまでもないものは省略できる
* 型を指定できない場合は、必ずDocコメントに型を記載する

#### @param

* 型は、オブジェクトの配列の場合、`stdClass[]`のように「クラス名＋[]」と記述する
* パラメータの型は、stringやintのようなプリミティブ型よりオブジェクトを推奨する

### コメントについて

* 手抜きをしている部分、将来直したい箇所には`@TODO`としてコメントを入れる
* 自分の考えを記録する
  * なぜそのようなコードになっているのか？
  * 定数などがなぜその値なのかの背景
  * コードの欠陥、使用できる条件など
* 読み手の理解のためにコメントする
  * 処理の全体像をコメントする
  * コードブロックにコメントをつけて概要をまとめる
  * 平均的な読み手が予期しない動作にはコメントする

### 例外処理について

例外を`throw`する際は`Exception`クラスは使用せず、内容によって以下の2つの例外を使い分ける。

[例外処理の考え方について](https://qiita.com/jnchito/items/3ef95ea144ed15df3637)

* `RuntimeException`
  * 発生してもバグとは限らない。通常の例外
  * インプットデータが不正な場合の例外処理など

* `LogicException`
  * 本来、実運用時には発生しない。発生したらバグ
  * 発生した場合、呼び出し元のコードを修正する必要がある例外

上記のクラスを継承した例外を作成する

##### 例

```php
class 削除するユーザが見つからない例外　extends LogicException
{
}
```
(考えられるケース)退会時にログインしているにもかかわらず、削除しようとしたユーザが見つからない

### ログについて

ログレベルごとに使い分ける。

[ログ設計指針](https://qiita.com/nanasess/items/350e59b29cceb2f122b3)

### 変数、定数名

* 何を表すかがわかりやすい名前を付ける
* 過度に抽象化した名前（`$オブジェクト`など）は使わない

### クラス名

* 原則として、名詞で役割・データ型を表す名前を付ける
* 原則として単数形を使う
* クラス名は何をするクラスか理解しやすい名前を付ける

### メソッド名

* 原則として、動詞、目的語＋動詞を付ける
* true/falseを返すメソッドは疑問形を最後にに付ける
* メソッド名は何をするメソッドか理解しやすい名前を付ける

#### コンストラクタでの処理

* コンストラクタ内では、クラスのロード、インスタンスの生成、プロパティへのセットなどのみを記述し、具体的な処理はできる限り実行しない。これは、テスト時にコンストラクタ内のオブジェクトをモックで差し替えことが難しいため（特にモデルオブジェクトをテスト時差し替えることはできない）

### セッションについて

* セッションにデータを保存する際は、Webがマルチウィンドウシステムであることを考慮する（例えば、セッションにアンケートオブジェクトを1つだけ保存する場合、別のアンケートを別タブで開くと、セッションに保存されているアンケートが更新されてしまう）
* モデル、ライブラリではセッションを使用しない

### SQLについて

#### 禁止事項

* 変数の文字列結合によるSQL文生成の禁止
  * 変数結合を使用せず、「クエリのバインディング」を使用してSQL文を生成する。<https://www.ipa.go.jp/security/awareness/vendor/programmingv2/contents/502.html>参照
* DBから日付を取得する処理の禁止
  * DBシステムの日付を使うとテストが非常に困難になるので、現在日時など時間を取得したい場合は、PHPから注入する

### Database Seederについて

* 本番（あるいはステージング）環境で必要となる初期データ（マスターデータなど）は、Seederクラスを作成する

## テストコード

### アノテーション

* テストファイルには必ず機能別のアノテーション（例：`@group ユーザ登録`）を記載する
* データベースにアクセスするテストケースには `@group データベース` を記載する（除外して実行できるようにするため）

### テストメソッド名

* 何のテストか、また、仕様または[振る舞い](https://techblog.yahoo.co.jp/advent-calendar-2018/ios/
)が明確になるような説明文をメソッド名とする

### DataProviderの命名規則について

DataProviderは基本的に`プロバイダ`というsuffixを指定する。

例：`ユーザプロバイダ`