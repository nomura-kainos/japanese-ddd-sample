# コードレビュー手順書

## 用語

* レビュア ... レビューする人
* レビュイ ... レビューを受ける人

## 前提

* ソースコードはプロジェクトの共同所有物である
  * 最初に誰が書いたかはあまり重要ではない
  * 誰もがどのコードでも修正、改善、保守できるべき（属人性の排除）
  * 書いた本人しか読めないコードがあってはいけない
* コードレビューは組織学習のプロセスである
  * レビュアがレビュイに一方的に教えるということではない
  * メンバー全員のスキルが向上することが重要
  * 誰が書いても一定以上の品質の読みやすいコードになるべき

## レビューの手順

1. 仕様を把握する
   * 関連する仕様書を読んで仕様を把握する
   * レビュイが必要な仕様書をすべて読んだか確認する
2. テストが警告なしで通ることを確認し、コードを静的解析する
   * `make test` でエラーが出ないことを確認する
   * テストが失敗したり、エラーが出た場合は差し戻す
3. テストコードを読む
4. プロダクトコードを読む
   * 規約との適合性を確認する
   * 仕様どおりに実装されているか確認する
   * 参考：[リーダブルコード適用 チェックリスト](https://qiita.com/AKB428/items/574f94695de51fa1fa19)

### レビュアのスキルが低い場合

レビュアのスキルが低く、コードを読んでも理解できない箇所がある場合は、まず、コードを理解することを目標にする。

* そもそもコードがどういう動作をするかわからない
* なぜ、そこにそのコードが書かれているのかわからない
* コードの意図がわからない
* なぜ、AでなくBという書き方なのかわからない
* コードに違和感がある

上記のような場合には、10分間、調べたり考えてもわからない場合は必ず質問する。

## コメントの書き方

コメントの先頭にタグをつけて、修正の要不要を示す。

MUST：
このままレビューを通してしまうと間違いなくバグが発生するコードや、仕様の把握に誤解があり必ず修正して欲しいところに使う。

THINK：
最低限の機能は果たすコードだけれども実行速度が極端に遅かったり、記述が冗長すぎたり、可読性が低かったりするときにこのタグを使う。

INFO：
コードそのものは動作するしこのままレビューを通しても問題ないが、「こう書いたらもっと速くなる」や「こう書いたら簡潔になる」といったアドバイスを書くときに使う。
必ずしも修正する必要はないものに使う。

TRIVIAL：
コメント内のTypoや重箱の隅を突くようなコメントを書くときに使う。
基本的に修正する必要はないという位置づけで使うが、直して欲しいときには、MUST と組み合わせて使う。

QUESTION：
コメント内の不明な箇所を質問するときに使う。
決して直して欲しいという意図ではなく、コードの意図など回答が欲しい時に利用する。

GOOD：
すこしでも光るものがあるコードが書かれた場合や、がんばった形跡があった場合等に使う。

例
```
MUST：xxにxxの脆弱性があります。

MUST/TRIVIAL：xxでTypoしています。
```

参考：[コードレビュー現場でのコミュニケーション](http://techblog.timers-inc.com/entry/2016/10/28/130000)から引用
